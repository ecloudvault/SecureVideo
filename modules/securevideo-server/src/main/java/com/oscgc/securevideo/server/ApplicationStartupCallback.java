package com.oscgc.securevideo.server;import com.oscgc.securevideo.server.model.Tenant;import com.oscgc.securevideo.server.model.Video;import com.oscgc.securevideo.server.model.VideoKey;import com.oscgc.securevideo.server.service.TenantService;import com.oscgc.securevideo.server.service.impl.VideoServiceImpl;import com.oscgc.securevideo.server.tool.CopyFileUtil;import com.oscgc.securevideo.server.tool.UuidGenerator;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.ApplicationListener;import org.springframework.context.event.ContextRefreshedEvent;import org.springframework.stereotype.Component;import java.net.URISyntaxException;import java.util.List;import java.util.Map;/** * Created by Yq on 2015/5/28. */@Componentpublic class ApplicationStartupCallback implements                                       ApplicationListener<ContextRefreshedEvent> {        @Autowired    private TenantService tenantService;        @Override    public void onApplicationEvent(ContextRefreshedEvent contextRefreshedEvent) {        if (VideoServiceImpl.getInstance() == null || VideoServiceImpl.getInstance()                                                                      .isEmpty()) {            initVideoList();        }    }        private void initVideoList() {        Video video = new Video();        VideoKey videoKey = new VideoKey();        List<Video> list = VideoServiceImpl.getInstance();                List<Tenant> tenants = tenantService.listTenants();        for (Tenant tenant : tenants) {            video = new Video();            videoKey = new VideoKey();            video.setId("BigBuckBunny_320x180-enc_0123456789012345");            video.setEncrptedFileName("BigBuckBunny_320x180-enc_0123456789012345.webm");            video.setEncrypted(true);            video.setFormart(".webm");            video.setName("BigBuckBunny_320x180.webm");            videoKey.setId("testvideokey1");            videoKey.setContent4Base64("lEDdU-HN3kYBekW4qgeRVg");            video.setVideoKey(videoKey);            video.setTenantId(tenant.getId());            list.add(video);        }                // coype init video file        String fromPath = CopyFileUtil.getVideosPath("BigBuckBunny_320x180-enc_0123456789012345.webm",                                                     "videos");        try {            String toPath = ApplicationStartupCallback.class.getClassLoader()                                                            .getResource("")                                                            .toURI()                                                            .getPath() + "/upload";            CopyFileUtil.copyDirectory(fromPath, toPath, false);        }        catch (URISyntaxException e) {            e.printStackTrace();        }            }}