<%@ page contentType="text/html;charset=UTF-8" pageEncoding="UTF-8" language="java" %><%@taglib prefix="template" tagdir="/WEB-INF/tags/template" %><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %><%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %><template:dashboardLayout>    <jsp:attribute name="content">        <script type="text/javascript" src="<c:url value='/static/js/ajaxfileupload.js'/>"></script>         <!-- Default box -->             <section class="content">                 <div class="box">                     <div class="box-header with-border">                         <h3 class="box-title"> All Videos</h3>                         <div style="float: right;">                             <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">                                 Upload Video                             </button>                         </div>                     </div>                     <div class="box-body">                         <div class="row">                             <c:forEach var="video" items="${videos}" varStatus="status">                                 <div class="col-md-3 text-center" alt="${video.name}">                                     <div class="box box-primary">                                         <div class="box-body videoList">                                             <a href="<c:url value='/video/detail/'/>${video.id}" data-toggle='modal'>                                                 <img src="/static/img/screenshot/${video.id}.jpg" class="screenshot" alt="${video.name}"/>                                                 <div class="caption">                                                     <c:choose>                                                         <c:when test="${fn:length(video.name) > 20}">                                                             <c:out value="${fn:substring(video.name, 0, 20)}......"/>                                                         </c:when>                                                         <c:otherwise>                                                             <c:out value="${video.name}"/>                                                         </c:otherwise>                                                     </c:choose>                                                 </div>                                             </a>                                         </div>                                         <!-- /.box-body -->                                         <c:if test="${!video.encrypted}">                                             <div class="overlay">                                                 <i class="fa fa-refresh fa-spin"></i>                                                 <div style="padding-top: 20%">Encrypting...</div>                                             </div>                                         </c:if>                                         <!-- end loading -->                                     </div>                                     <!-- /.box -->                                 </div>                             </c:forEach>                         </div>                         <!-- Modal -->                         <div class="modal fade" id="myModal" data-keyboard="false" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">                             <div class="modal-dialog">                                 <div class="modal-content">                                     <div class="modal-header">                                         <h4 class="modal-title" id="myModalLabel">Upload Video</h4>                                     </div>                                     <div class="modal-body">                                             <%--<form action="<c:url value='/upload/post'/>" method="post" enctype="multipart/form-data">--%>                                         <div class="row">                                             <div class="col-md-offset-2 col-md-8">                                                 <div class="input-group">                                                     <input type="file" id="uploadfile" accept=".webm" name="videofile" class="form-control" required>                                                  <span class="input-group-btn">                                                        <input type="button" value="upload" id="uploadSubmit" class="btn btn-primary">                                                  </span>                                                 </div>                                                 <!-- /input-group -->                                             </div>                                         </div>                                         <div class="uploading upload-info" id="uploading">                                             <div class="text-center">The video is uploading...</div>                                             <div class="progress">                                                 <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="10" aria-valuemax="100" style="width:                                                     100%">                                                 </div>                                             </div>                                         </div>                                         <div class="uploading upload-info" id="encrypting">                                             <div class="overlay">                                                 <i class="fa fa-refresh fa-spin" style="font-size: 30px;color:#bce8f1;position: absolute;top: 0;left: 25%;margin: 15px; "></i>                                                 <div class="text-center" style="padding-top: 10px;">The video is encrypting...</div>                                             </div>                                         </div>                                             <%--</form>--%>                                     </div>                                     <div class="modal-footer upload-footer" id="modelfooter">                                         <button type="button" id="closebtn" class="btn btn-default" data-dismiss="modal">Close</button>                                     </div>                                 </div>                             </div>                         </div>                     </div>                     <!-- /.box-body -->                 </div>             </section><!-- /.content -->        <script>            function ajaxFileUpload() {                $("#uploading").css("display", "block");                $("#closebtn").css("display", "none");                $.ajaxFileUpload({                    url: '/${requestScope._currentTenant.namespace}/upload/post',                    secureuri: false,                    fileElementId: 'uploadfile',                    dataType: 'json',                    success: function (data, status) {                        $("#uploading").css("display", "none");                        if (data.complete) {                            id = data.videoId;                            $("#encrypting").css("display", "block");                            setInterval(checkIsEncrypted, 10000);                        } else {                            $('#myModal').modal('hide');                            $("#errorPanel").css("display","block");                            $("#errormsg").text(data.error);                        }                    },                    error: function (data, status, e) {                        $('#myModal').modal('hide');                        $("#uploading").css("display", "none");                        $("#errorPanel").css("display","block");                        $("#errormsg").text("upload faile!");                        console.error("upload faile!")                    }                });            }            function checkIsEncrypted() {                $.ajax({                    url: "/video/isEncrypted/" + id, success: function (data) {                        if (data === "true") {                            window.location.href = '${pageContext.request.contextPath}/video/list';                        }                    }                });            }            $(".screenshot").bind('error', function () {                $(this).attr("src", "/static/img/screenshot/default.png")                $(this).onerror = null;            });            $("#uploadSubmit").on('click', ajaxFileUpload);        </script>    </jsp:attribute></template:dashboardLayout>